<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GHC573QJ35"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GHC573QJ35');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>logs - ntna</title>
    <link rel="icon" type="image/x-icon" href="/images/hi.ico">
    <link rel="stylesheet" href="/style.css">
    <style>
        .logs-container {
            max-width: 850px;
            margin: 0 auto;
            padding: 30px;
        }

        .logs-item {
            padding: 12px 0;
            border-bottom: 1px solid #414868;
            transition: background-color 0.2s ease;
        }
        
        .logs-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 4px;
        }
        
        .logs-item-header:hover {
            background-color: rgba(36, 40, 59, 0.2);
        }

        .logs-item:hover {
            background-color: rgba(36, 40, 59, 0.2);
        }

        .logs-item:last-child {
            border-bottom: none;
        }

        .item-content {
            flex: 1;
        }

        .item-title {
            color: #c0caf5;
            margin: 0;
            font-size: 0.95em;
            font-weight: bold;
        }

        .item-type {
            color: #9aa5ce;
            font-size: 0.85em;
            margin: 5px 0 0 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .link-icon {
            width: 12px;
            height: 12px;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }



        .item-date {
            color: #565f89;
            font-size: 0.85em;
            white-space: nowrap;
            margin-left: 20px;
        }

        .item-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75em;
            margin-left: 8px;
            font-weight: bold;
        }

        .status-reading { background-color: #7aa2f7; color: #1a1b26; }
        .status-finished { background-color: #9ece6a; color: #1a1b26; }
        .status-to_read { background-color: #f7768e; color: #1a1b26; }
        .status-abandoned { background-color: #565f89; color: #c0caf5; }
        .status-reference { background-color: #bb9af7; color: #1a1b26; }

        .metadata-details {
            background-color: #1f2335;
            border: 1px solid #414868;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            display: none;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .metadata-details.expanded {
            display: block;
        }

        .metadata-details h4 {
            margin: 0 0 8px 0;
            color: #7aa2f7;
            font-size: 0.9em;
        }

        .metadata-details p {
            margin: 4px 0;
            color: #a9b1d6;
            font-size: 0.8em;
            line-height: 1.3;
        }

        .metadata-details .author {
            color: #c0caf5;
            font-weight: bold;
        }

        .metadata-details .director {
            color: #c0caf5;
            font-weight: bold;
        }
        
        .source-item {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #414868;
        }
        
        .source-item p {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .source-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #7aa2f7;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        
        .source-link:hover {
            opacity: 0.8;
        }
        
        .source-item .link-icon {
            width: 12px;
            height: 12px;
            opacity: 0.8;
        }

        .section-header {
            color: #9aa5ce;
            font-size: 1.5em;
            margin: 30px 0 2px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid #414868;
        }
        
        .section-header.no-border {
            border-bottom: none;
            margin-bottom: 0;
        }

        .loading {
            text-align: center;
            color: #565f89;
            padding: 40px;
        }

        .error {
            color: #f7768e;
            text-align: center;
            padding: 20px;
            background-color: rgba(247, 118, 142, 0.1);
            border: 1px solid #f7768e;
            border-radius: 6px;
            margin: 20px 0;
        }

        .tags {
            margin-top: 4px;
        }

        .tag {
            display: inline-block;
            background-color: #414868;
            color: #a9b1d6;
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 3px;
            margin-right: 4px;
        }

        .notes {
            margin-top: 8px;
            color: #9aa5ce;
            font-style: italic;
            font-size: 0.8em;
        }

        .metadata-notes {
            white-space: pre-line;
        }

        @media (max-width: 768px) {
            .logs-container {
                padding: 15px;
            }
            
            .logs-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .item-date {
                margin-left: 0;
            }
            
            .metadata-details {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="/">home</a></li>
                <li><a href="/startups.html">startups</a></li>
                <!-- <li><a href="/resume.html">resume</a></li> -->
                <li><a href="/logs.html" style="font-weight:bold; border-bottom: 1px solid #9dafff; color: #9dafff;">logs</a></li>
            </ul>
            <div style="display: flex; gap: 10px;">
                <a href="https://linkedin.com/in/ntna" target="_blank" class="github-nav-link" style="margin-right: 10px;">
                    <svg style="width: 1.8em; height: 1.8em; vertical-align: -.125em;" viewBox="0 0 448 512">
                        <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/>
                    </svg>
                </a>
                <a href="https://github.com/ntna141" target="_blank" class="github-nav-link" style="margin-right: 15px;">
                    <svg style="width: 1.8em; height: 1.8em; vertical-align: -.125em;" viewBox="0 0 496 512">
                        <path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/>
                    </svg>
                </a>
            </div>
        </nav>
    </header>

    <main class="logs-container">
        <div id="loading" class="loading">Loading history...</div>
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="currently-reading-section" style="display: none;">
            <h2 class="section-header">in progress</h2>
            <div id="currently-reading-list"></div>
        </div>

        <div id="to_read-section" style="display: none;">
            <h2 class="section-header">up next</h2>
            <div id="to_read-list"></div>
        </div>

        <div id="finished-section" style="display: none;">
            <h2 class="section-header no-border">finished</h2>
            <small style="color: #666; font-size: 11px; margin-top: -5px; display: block;">(since aug 2025)</small>
            <div style="border-bottom: 1px solid #414868; margin: 8px 0 2px 0;"></div>
            <div id="finished-list"></div>
        </div>
    </main>

    <script>
        // Extract domain from URL
        function extractDomain(url) {
            try {
                const urlObj = new URL(url);
                return urlObj.hostname.replace('www.', '');
            } catch (error) {
                return url;
            }
        }
        
        // Format date to readable format (relative time for recent, actual dates for older)
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // Show relative time only for items within a month
            if (diffDays === 1) return 'today';
            if (diffDays === 2) return 'yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.ceil(diffDays / 7)} weeks ago`;
            
            // For anything older than a month, just show the actual date
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        // Format date with actual date and relative time for tooltips
        function formatDateWithRelative(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const actualDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            
            // Only add relative time for items within a month
            if (diffDays === 1) return `${actualDate} (today)`;
            if (diffDays === 2) return `${actualDate} (yesterday)`;
            if (diffDays < 7) return `${actualDate} (${diffDays} days ago)`;
            if (diffDays < 30) return `${actualDate} (${Math.ceil(diffDays / 7)} weeks ago)`;
            
            // For anything older than a month, just show the actual date
            return actualDate;
        }

        // Create reading log item HTML
        function createReadingLogItem(item) {
            const itemDiv = document.createElement('div');
            
            // Check if item has a source/link
            const hasSource = item.source || (item.metadata && item.metadata.source);
            const sourceUrl = item.source || (item.metadata && item.metadata.source);
            
            itemDiv.className = 'logs-item';
            
            let typeDisplay = item.type.replace('_', ' ');
            
            // No link icon in main list
            
            // Determine what date to show based on status
            let dateDisplay = '';
            if (item.status === 'reading' && item.date_started) {
                dateDisplay = `<div class="item-date">${formatDate(item.date_started)}</div>`;
            } else if (item.status === 'to_read') {
                dateDisplay = '';
            } else if (item.status === 'finished') {
                dateDisplay = `<div class="item-date">${formatDate(item.date_finished || item.created_at)}</div>`;
            } else {
                dateDisplay = `<div class="item-date">${formatDate(item.date_finished || item.created_at)}</div>`;
            }
            
            itemDiv.innerHTML = `
                <div class="logs-item-header">
                    <div class="item-content">
                        <h3 class="item-title">${item.title}</h3>
                        <p class="item-type">${typeDisplay}</p>
                        ${item.tags && item.tags.length > 0 ? `
                            <div class="tags">
                                ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                    ${dateDisplay}
                </div>
                <div class="metadata-details">
                    ${createMetadataTooltip(item)}
                </div>
            `;
            
            // Add click handler for expanding details
            const header = itemDiv.querySelector('.logs-item-header');
            const details = itemDiv.querySelector('.metadata-details');
            
            header.addEventListener('click', function(e) {
                // Remove link opening from main header since there's no icon
                
                // Check if this item is currently expanded
                const isExpanded = details.classList.contains('expanded');
                
                // Close all other expanded details first
                const allDetails = document.querySelectorAll('.metadata-details.expanded');
                allDetails.forEach(detail => {
                    if (detail !== details) {
                        detail.classList.remove('expanded');
                    }
                });
                
                // Toggle current item (if it wasn't expanded, expand it; if it was, close it)
                if (!isExpanded) {
                    details.classList.add('expanded');
                } else {
                    details.classList.remove('expanded');
                }
            });
            
            // Add click handler for source links in details
            itemDiv.addEventListener('click', function(e) {
                const sourceLink = e.target.closest('.source-link');
                if (sourceLink) {
                    e.stopPropagation();
                    const url = sourceLink.getAttribute('data-url');
                    if (url) {
                        window.open(url, '_blank');
                    }
                }
            });
            
            return itemDiv;
        }

        // Create metadata tooltip content
        function createMetadataTooltip(item) {
            let content = '';
            

            
            // Reading Information Section
            if (item.date_started) {
                content += `<p><strong>Started:</strong> ${formatDateWithRelative(item.date_started)}</p>`;
            }
            if (item.date_finished) {
                content += `<p><strong>Finished:</strong> ${formatDateWithRelative(item.date_finished)}</p>`;
            }
            
            // Book/Content Information Section
            if (item.metadata) {
                if (item.metadata.author) {
                    content += `<p><strong>Author:</strong> <span class="author">${item.metadata.author}</span></p>`;
                }
                if (item.metadata.published) {
                    content += `<p><strong>Published:</strong> <span class="author">${item.metadata.published}</span></p>`;
                }
                if (item.metadata.director) {
                    content += `<p><strong>Director:</strong> <span class="director">${item.metadata.director}</span></p>`;
                }
                if (item.metadata.released) {
                    content += `<p><strong>Released:</strong> <span class="author">${item.metadata.released}</span></p>`;
                }
                if (item.metadata.pages) {
                    content += `<p><strong>Pages:</strong> ${item.metadata.pages}</p>`;
                }
                if (item.metadata.duration) {
                    content += `<p><strong>Duration:</strong> ${item.metadata.duration}</p>`;
                }
                
                // Publication Information
                if (item.metadata.publisher || item.metadata.publication_date || item.metadata.isbn) {
                    if (item.metadata.publisher) {
                        content += `<p><strong>Publisher:</strong> ${item.metadata.publisher}</p>`;
                    }
                    if (item.metadata.publication_date) {
                        content += `<p><strong>Published:</strong> ${item.metadata.publication_date}</p>`;
                    }
                    if (item.metadata.isbn) {
                        content += `<p><strong>ISBN:</strong> ${item.metadata.isbn}</p>`;
                    }
                }
            }
            
            // Source domain section (last item above divider)
            const sourceUrl = item.source || (item.metadata && item.metadata.source);
            if (sourceUrl) {
                const domain = extractDomain(sourceUrl);
                content += `<p><strong>Source:</strong> <span class="source-link" data-url="${sourceUrl}"><span>${domain}</span><svg class="link-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"/></svg></span></p>`;
            }
            
            // if (item.notes) {
            //     content += `<div class="source-item"><p><strong>Notes:</strong></p><p class="metadata-notes">${item.notes}</p></div>`;
            // }
            
            return content;
        }

        // Fetch and display reading log
        async function loadReadingLog() {
            try {
                const response = await fetch('https://ntna-site-api.vercel.app/api/blog?action=reading-log');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                document.getElementById('loading').style.display = 'none';
                
                if (data.reading_log && data.reading_log.length > 0) {
                    // Separate items by status
                    const currentlyReading = data.reading_log.filter(item => item.status === 'reading');
                    const toRead = data.reading_log.filter(item => item.status === 'to_read');
                    const finished = data.reading_log.filter(item => item.status === 'finished');
                    
                    // Display currently reading section
                    if (currentlyReading.length > 0) {
                        const currentlyReadingSection = document.getElementById('currently-reading-section');
                        const currentlyReadingList = document.getElementById('currently-reading-list');
                        
                        currentlyReading.forEach(item => {
                            currentlyReadingList.appendChild(createReadingLogItem(item));
                        });
                        
                        currentlyReadingSection.style.display = 'block';
                    }
                    
                    // Display to read section
                    if (toRead.length > 0) {
                        const toReadSection = document.getElementById('to_read-section');
                        const toReadList = document.getElementById('to_read-list');
                        
                        toRead.forEach(item => {
                            toReadList.appendChild(createReadingLogItem(item));
                        });
                        
                        toReadSection.style.display = 'block';
                    }
                    
                    // Display finished section
                    if (finished.length > 0) {
                        const finishedSection = document.getElementById('finished-section');
                        const finishedList = document.getElementById('finished-list');
                        
                        // Sort finished items by date_finished (latest first)
                        const sortedFinished = finished.sort((a, b) => {
                            const dateA = new Date(a.date_finished || a.created_at);
                            const dateB = new Date(b.date_finished || b.created_at);
                            return dateB - dateA; // Latest first
                        });
                        
                        sortedFinished.forEach(item => {
                            finishedList.appendChild(createReadingLogItem(item));
                        });
                        
                        finishedSection.style.display = 'block';
                    }
                    
                } else {
                    document.getElementById('error').textContent = 'No reading log entries found.';
                    document.getElementById('error').style.display = 'block';
                }
                
            } catch (error) {
                console.error('Error loading reading log:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').textContent = `Failed to load reading log: ${error.message}`;
                document.getElementById('error').style.display = 'block';
            }
        }

        // Load reading log when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load reading log data
            loadReadingLog();
            
            // Add click outside handler to close metadata details
            document.addEventListener('click', function(e) {
                // Check if click is outside all metadata details and their headers
                const clickedElement = e.target;
                const isInsideHeader = clickedElement.closest('.logs-item-header');
                const isInsideDetails = clickedElement.closest('.metadata-details');
                
                // If clicked outside both header and details, close all expanded details
                if (!isInsideHeader && !isInsideDetails) {
                    const allDetails = document.querySelectorAll('.metadata-details.expanded');
                    allDetails.forEach(detail => {
                        detail.classList.remove('expanded');
                    });
                }
            });
        });
    </script>
</body>
</html>
